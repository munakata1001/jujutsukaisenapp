# 呪術廻戦ポップアップショップ予約カレンダー 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
呪術廻戦ポップアップショップ予約カレンダーデモアプリ

### 1.2 プロジェクトの目的
ポップアップショップへの来店予約を管理し、混雑を緩和するとともに、受注生産商品の購入を効率的に管理する。

### 1.3 背景
- ポップアップショップへの来店者が集中し、混雑が発生している
- 受注生産商品の購入希望者を事前に把握し、生産計画を立てる必要がある
- 来店者の待ち時間を削減し、スムーズな購入体験を提供したい

## 2. 対象ユーザー

### 2.1 一般ユーザー
- 呪術廻戦のファン
- ポップアップショップ来店希望者
- 受注生産商品の購入希望者

### 2.2 管理者
- ショップ運営スタッフ
- 予約枠の管理を行う担当者

## 3. 機能要件

### 3.1 予約機能

#### 3.1.1 予約作成
- **機能概要**: ユーザーが来店日時を予約する
- **必須入力項目**:
  - 来店希望日時
  - 氏名
  - メールアドレス
  - 電話番号
- **処理内容**:
  - 予約可能枠の確認
  - 予約データの保存
  - 予約確認メールの送信
  - 予約番号の発行

#### 3.1.2 予約確認
- **機能概要**: 予約内容を確認する
- **表示項目**:
  - 予約番号
  - 来店日時
  - 予約ステータス
  - 予約した商品情報

### 3.2 カレンダー機能

#### 3.2.1 カレンダー表示
- **機能概要**: 予約可能な日時をカレンダー形式で表示
- **表示内容**:
  - 月次カレンダー表示
  - 各日の予約可能枠数
  - 予約状況の可視化（空きあり、残りわずか、完売）
  - 時間帯別の予約状況

#### 3.2.2 日時選択
- **機能概要**: カレンダーから来店希望日時を選択
- **制約事項**:
  - 予約可能な日時のみ選択可能
  - 過去の日時は選択不可
  - 満席の時間帯は選択不可

### 3.3 予約枠管理機能（管理者向け）

#### 3.3.1 予約枠設定
- **機能概要**: 管理者が予約可能な枠を設定・変更する
- **設定項目**:
  - 日付
  - 時間帯
  - 各時間帯の定員数
  - 予約受付開始日時
  - 予約受付終了日時

#### 3.3.2 予約枠編集
- **機能概要**: 既存の予約枠を編集・削除する
- **機能**:
  - 定員数の変更
  - 予約枠の一時停止
  - 予約枠の削除

#### 3.3.3 予約状況確認
- **機能概要**: 日時別の予約状況を確認する
- **表示内容**:
  - 日時別の予約者数
  - 予約者リスト
  - 予約率の表示

### 3.4 予約管理機能

#### 3.4.1 予約一覧表示
- **機能概要**: 予約一覧を表示する
- **表示項目**:
  - 予約番号
  - 予約者名
  - 来店日時
  - 予約ステータス
  - 予約商品情報

#### 3.4.2 予約検索
- **機能概要**: 予約を検索する
- **検索条件**:
  - 予約番号
  - 予約者名
  - 来店日時
  - メールアドレス

#### 3.4.3 予約キャンセル
- **機能概要**: 予約をキャンセルする
- **処理内容**:
  - 予約ステータスの更新
  - 予約枠の空き数の更新

#### 3.4.4 予約変更
- **機能概要**: 予約日時を変更する
- **制約事項**:
  - 変更先の空き状況を確認
  - 来店日の前日まで変更可能

### 3.5 グッズ購入制限機能

#### 3.5.1 商品登録
- **機能概要**: 受注生産商品を登録する
- **登録項目**:
  - 商品名
  - 商品説明
  - 価格
  - 受注期間（開始日〜終了日）
  - 1予約あたりの購入制限数

#### 3.5.2 購入制限設定
- **機能概要**: 商品ごとの購入制限を設定する
- **制限項目**:
  - 1予約あたりの最大購入数
  - 1ユーザーあたりの最大購入数（期間内）
  - 総受注数の上限

#### 3.5.3 購入制限チェック
- **機能概要**: 予約時に購入制限をチェックする
- **チェック内容**:
  - 予約あたりの購入数制限
  - ユーザーあたりの購入数制限
  - 受注期間内かどうか
  - 総受注数の上限チェック

#### 3.5.4 購入商品選択
- **機能概要**: 予約時に購入希望商品を選択する
- **機能**:
  - 商品リストの表示
  - 数量選択
  - 購入制限のリアルタイムチェック
  - 合計金額の表示

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **ページ表示速度**: 初期表示2秒以内
- **同時接続数**: 500ユーザーまで対応
- **API応答時間**: 1秒以内

### 4.2 セキュリティ要件
- **認証**: Firebase Authenticationを使用
- **通信**: HTTPS必須
- **データ保護**: 個人情報の適切な管理
- **CSRF対策**: トークンベースのCSRF対策

### 4.3 可用性要件
- **稼働率**: 99%以上
- **バックアップ**: Firebaseの自動バックアップ機能を活用

### 4.4 互換性要件
- **ブラウザ対応**: Chrome、Safari、Firefox、Edge（最新版）
- **デバイス対応**: スマートフォン、タブレット、PC

### 4.5 ユーザビリティ要件
- **操作性**: 直感的な操作で予約まで3ステップ以内
- **レスポンシブデザイン**: モバイルファーストで設計

## 5. 技術要件

### 5.1 フロントエンド
- **フレームワーク**: React
- **状態管理**: React Context API または Redux
- **UIライブラリ**: Material-UI または Tailwind CSS
- **ルーティング**: React Router
- **カレンダーライブラリ**: react-calendar または react-big-calendar

### 5.2 バックエンド
- **フレームワーク**: FastAPI
- **API設計**: RESTful API
- **認証**: Firebase Admin SDK
- **バリデーション**: Pydantic

### 5.3 データベース・ストレージ
- **データベース**: Firebase Firestore
- **認証**: Firebase Authentication
- **ストレージ**: Firebase Storage（必要に応じて）

### 5.4 インフラ
- **ホスティング**: 
  - フロントエンド: Vercel または Netlify
  - バックエンド: Railway または Render
- **ドメイン**: カスタムドメイン対応

## 6. データモデル

### 6.1 主要エンティティ

#### 6.1.1 予約（Reservation）
```
- reservation_id: string (主キー)
- reservation_number: string (ユニーク)
- user_email: string
- user_name: string
- user_phone: string
- visit_date: timestamp
- visit_time: string
- status: string (pending, confirmed, cancelled, completed)
- products: array (商品IDと数量)
- created_at: timestamp
- updated_at: timestamp
```

#### 6.1.2 予約枠（TimeSlot）
```
- slot_id: string (主キー)
- date: date
- time: string
- capacity: number (定員数)
- reserved_count: number (予約済み数)
- is_available: boolean
- created_at: timestamp
- updated_at: timestamp
```

#### 6.1.3 商品（Product）
```
- product_id: string (主キー)
- name: string
- description: string
- price: number
- order_start_date: timestamp
- order_end_date: timestamp
- max_per_reservation: number (1予約あたりの最大購入数)
- max_per_user: number (1ユーザーあたりの最大購入数)
- total_order_limit: number (総受注数上限)
- current_order_count: number (現在の受注数)
- is_active: boolean
- created_at: timestamp
- updated_at: timestamp
```

#### 6.1.4 ユーザー購入履歴（UserPurchaseHistory）
```
- history_id: string (主キー)
- user_email: string
- product_id: string
- quantity: number
- reservation_id: string
- purchase_date: timestamp
```

## 7. API設計（主要エンドポイント）

### 7.1 予約関連
- `POST /api/reservations` - 予約作成
- `GET /api/reservations/{reservation_id}` - 予約詳細取得
- `GET /api/reservations` - 予約一覧取得（管理者）
- `PUT /api/reservations/{reservation_id}` - 予約更新
- `DELETE /api/reservations/{reservation_id}` - 予約キャンセル

### 7.2 カレンダー関連
- `GET /api/calendar` - カレンダーデータ取得（月次）
- `GET /api/timeslots` - 予約可能枠取得（日付指定）
- `GET /api/timeslots/availability` - 空き状況確認

### 7.3 予約枠管理（管理者）
- `POST /api/admin/timeslots` - 予約枠作成
- `PUT /api/admin/timeslots/{slot_id}` - 予約枠更新
- `DELETE /api/admin/timeslots/{slot_id}` - 予約枠削除
- `GET /api/admin/timeslots/stats` - 予約状況統計

### 7.4 商品管理
- `GET /api/products` - 商品一覧取得
- `GET /api/products/{product_id}` - 商品詳細取得
- `POST /api/admin/products` - 商品登録（管理者）
- `PUT /api/admin/products/{product_id}` - 商品更新（管理者）
- `GET /api/products/{product_id}/availability` - 購入可能数確認

## 8. UI/UX要件

### 8.1 画面構成
1. **トップページ**: 予約開始ボタン、商品一覧
2. **カレンダー画面**: 月次カレンダー、日時選択
3. **予約入力画面**: ユーザー情報入力、商品選択
4. **予約確認画面**: 予約内容確認、予約確定
5. **予約完了画面**: 予約番号表示、確認メール送信通知
6. **予約管理画面**: 予約一覧、検索、詳細確認
7. **管理者画面**: 予約枠管理、予約管理、商品管理

### 8.2 デザイン方針
- **テーマ**: 呪術廻戦の世界観を反映
- **カラー**: ダークトーンを基調
- **レスポンシブ**: モバイルファースト設計

## 9. 制約事項

### 9.1 ビジネス制約
- 予約可能期間: 開催期間中の日時のみ
- キャンセル期限: 来店日の前日まで
- 購入制限: 商品ごとに設定された制限を厳守

### 9.2 技術的制約
- Firebaseの無料プランの制限内で運用
- API呼び出し回数の制限に注意

## 10. テスト要件

### 10.1 単体テスト
- 各コンポーネントのテスト
- APIエンドポイントのテスト

### 10.2 結合テスト
- 予約フローのエンドツーエンドテスト
- 購入制限機能のテスト

### 10.3 ユーザーテスト
- 実際のユーザーによる操作テスト

## 11. 開発スケジュール（参考）

### Phase 1: 環境構築・設計（1週間）
- 開発環境構築
- データベース設計
- API設計

### Phase 2: バックエンド開発（2週間）
- FastAPI実装
- Firestore連携
- 認証機能実装

### Phase 3: フロントエンド開発（2週間）
- React実装
- カレンダー機能実装
- UI実装

### Phase 4: 統合・テスト（1週間）
- 統合テスト
- バグ修正
- デプロイ準備

---

**文書バージョン**: 1.0  
**作成日**: 2024年

